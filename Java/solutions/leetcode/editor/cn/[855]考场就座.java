// 
// @Question: [855]è€ƒåœºå°±åº§ 
// @Author: cwp0
// @CreatedTime: 2024-12-23 12:53:08
// @Description: 
//åœ¨è€ƒåœºé‡Œï¼Œä¸€æ’æœ‰ N ä¸ªåº§ä½ï¼Œåˆ†åˆ«ç¼–å·ä¸º 0, 1, 2, ..., N-1 ã€‚ 
//
// å½“å­¦ç”Ÿè¿›å…¥è€ƒåœºåï¼Œä»–å¿…é¡»ååœ¨èƒ½å¤Ÿä½¿ä»–ä¸ç¦»ä»–æœ€è¿‘çš„äººä¹‹é—´çš„è·ç¦»è¾¾åˆ°æœ€å¤§åŒ–çš„åº§ä½ä¸Šã€‚å¦‚æœæœ‰å¤šä¸ªè¿™æ ·çš„åº§ä½ï¼Œä»–ä¼šååœ¨ç¼–å·æœ€å°çš„åº§ä½ä¸Šã€‚(å¦å¤–ï¼Œå¦‚æœè€ƒåœºé‡Œæ²¡æœ‰äººï¼Œ
//é‚£ä¹ˆå­¦ç”Ÿå°±ååœ¨ 0 å·åº§ä½ä¸Šã€‚) 
//
// è¿”å› ExamRoom(int N) ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªå…¬å¼€çš„å‡½æ•°ï¼šå…¶ä¸­ï¼Œå‡½æ•° ExamRoom.seat() ä¼šè¿”å›ä¸€ä¸ª int ï¼ˆæ•´å‹æ•°æ®ï¼‰ï¼Œä»£è¡¨å­¦ç”Ÿåçš„ä½
//ç½®ï¼›å‡½æ•° ExamRoom.leave(int p) ä»£è¡¨ååœ¨åº§ä½ p ä¸Šçš„å­¦ç”Ÿç°åœ¨ç¦»å¼€äº†è€ƒåœºã€‚æ¯æ¬¡è°ƒç”¨ ExamRoom.leave(p) æ—¶éƒ½ä¿è¯æœ‰å­¦ç”Ÿååœ¨
//åº§ä½ p ä¸Šã€‚ 
//
// 
//
// ç¤ºä¾‹ï¼š 
//
// è¾“å…¥ï¼š["ExamRoom","seat","seat","seat","seat","leave","seat"], [[10],[],[],[],[]
//,[4],[]]
//è¾“å‡ºï¼š[null,0,9,4,2,null,5]
//è§£é‡Šï¼š
//ExamRoom(10) -> null
//seat() -> 0ï¼Œæ²¡æœ‰äººåœ¨è€ƒåœºé‡Œï¼Œé‚£ä¹ˆå­¦ç”Ÿååœ¨ 0 å·åº§ä½ä¸Šã€‚
//seat() -> 9ï¼Œå­¦ç”Ÿæœ€åååœ¨ 9 å·åº§ä½ä¸Šã€‚
//seat() -> 4ï¼Œå­¦ç”Ÿæœ€åååœ¨ 4 å·åº§ä½ä¸Šã€‚
//seat() -> 2ï¼Œå­¦ç”Ÿæœ€åååœ¨ 2 å·åº§ä½ä¸Šã€‚
//leave(4) -> null
//seat() -> 5ï¼Œå­¦ç”Ÿæœ€åååœ¨ 5 å·åº§ä½ä¸Šã€‚
// 
//
// 
//
// æç¤ºï¼š 
//
// 
// 1 <= N <= 10^9 
// åœ¨æ‰€æœ‰çš„æµ‹è¯•æ ·ä¾‹ä¸­ ExamRoom.seat() å’Œ ExamRoom.leave() æœ€å¤šè¢«è°ƒç”¨ 10^4 æ¬¡ã€‚ 
// ä¿è¯åœ¨è°ƒç”¨ ExamRoom.leave(p) æ—¶æœ‰å­¦ç”Ÿæ­£ååœ¨åº§ä½ p ä¸Šã€‚ 
// 
//
// Related Topics è®¾è®¡ æœ‰åºé›†åˆ å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰ ğŸ‘ 283 ğŸ‘ 0

// æ—¶é—´å¤æ‚åº¦ï¼šO()
// ç©ºé—´å¤æ‚åº¦ï¼šO()
//leetcode submit region begin(Prohibit modification and deletion)
class ExamRoom {
    int n;
    TreeSet<Integer> seats;
    PriorityQueue<int[]> pq;

    public ExamRoom(int n) {
        this.n = n;
        this.seats = new TreeSet<Integer>();
        this.pq = new PriorityQueue<int[]>((a, b) -> {
            int d1 = a[1] - a[0], d2 = b[1] - b[0];
            return d1 / 2 < d2 / 2 || (d1 / 2 == d2 / 2 && a[0] > b[0]) ? 1 : -1;
        });
    }

    public int seat() {
        if (seats.isEmpty()) {
            seats.add(0);
            return 0;
        }
        int left = seats.first(), right = n - 1 - seats.last();
        while (seats.size() >= 2) {
            int[] p = pq.peek();
            if (seats.contains(p[0]) && seats.contains(p[1]) && seats.higher(p[0]) == p[1]) { // ä¸å±äºå»¶è¿Ÿåˆ é™¤çš„åŒºé—´
                int d = p[1] - p[0];
                if (d / 2 < right || d / 2 <= left) { // æœ€å·¦æˆ–æœ€å³çš„åº§ä½æ›´ä¼˜
                    break;
                }
                pq.poll();
                pq.offer(new int[]{p[0], p[0] + d / 2});
                pq.offer(new int[]{p[0] + d / 2, p[1]});
                seats.add(p[0] + d / 2);
                return p[0] + d / 2;
            }
            pq.poll(); // leave å‡½æ•°ä¸­å»¶è¿Ÿåˆ é™¤çš„åŒºé—´åœ¨æ­¤æ—¶åˆ é™¤
        }
        if (right > left) { // æœ€å³çš„ä½ç½®æ›´ä¼˜
            pq.offer(new int[]{seats.last(), n - 1});
            seats.add(n - 1);
            return n - 1;
        } else {
            pq.offer(new int[]{0, seats.first()});
            seats.add(0);
            return 0;
        }
    }

    public void leave(int p) {
        if (p != seats.first() && p != seats.last()) {
            int prev = seats.lower(p), next = seats.higher(p);
            pq.offer(new int[]{prev, next});
        }
        seats.remove(p);
    }
}

/**
 * Your ExamRoom object will be instantiated and called as such:
 * ExamRoom obj = new ExamRoom(n);
 * int param_1 = obj.seat();
 * obj.leave(p);
 */
//leetcode submit region end(Prohibit modification and deletion)

